<html><head>
<script>
var testcase_items = new Array();
var active = false;
var tab_id = null;

chrome.extension.onRequest.addListener(function(request, sender, sendResponse) {
  if (request.action == "append") {
    testcase_items[testcase_items.length] = request.obj;
    sendResponse({});
  }
  if (request.action == "get_status") {
    sendResponse({'active': active});
  }
  if (request.action == "start") {
	if(!active) {
	    active = true;
	    testcase_items = new Array();
	    tab_id = request.recorded_tab;
	    chrome.tabs.update(tab_id, {url: request.start_url}, function() {
	        chrome.tabs.sendRequest(tab_id, {action: "open", 'url': request.start_url});
	    });
	    sendResponse({start: true});
	}
  }
  if (request.action == "stop") {
    active = false;
    chrome.tabs.sendRequest(tab_id, {action: "stop"});
    sendResponse({});
  }
  if (request.action == "get_items") {
	sendResponse({'items': testcase_items});
  }
});
</script>
</head>
<body>
</body>
</html>
